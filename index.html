<html>
  <head>
    <meta charset="UTF-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <meta content="#023602" name="theme-color" />
    <link href="./styles.css" rel="stylesheet" />
  </head>
  <body>
    <div id="board">
      <h3>BOARD</h3>
      <div>
        <span class="card missing">‚Ä¶</span>
        <span class="card missing">‚Ä¶</span>
        <span class="card missing">‚Ä¶</span>
        <span class="card missing">‚Ä¶</span>
        <span class="card missing">‚Ä¶</span>
      </div>
    </div>

    <div id="hands">
      <h3>
        HANDS
        <button>+</button>
      </h3>
      <div>
        <div>1</div>
        <span class="card">‚Ä¶</span>
        <span class="card">‚Ä¶</span>
      </div>
      <div>
        <div>2</div>
        <span class="card">‚Ä¶</span>
        <span class="card">‚Ä¶</span>
      </div>
      <div>
        <div>3</div>
        <span class="card">‚Ä¶</span>
        <span class="card">‚Ä¶</span>
      </div>
    </div>

    <div id="rank">
      <h3>RANK</h3>
      <canvas></canvas>
      <div>
        <button>Board</button>
        <button>Hand 1</button>
        <button>Hand 2</button>
      </div>
    </div>

    <div id="stats">
      <h3>STATS</h3>
      <div>
        <div>Œº <i>Expected rank</i></div>
        <div>‚Ä¶</div>
        <div>œÉ <i>Std dev rank</i></div>
        <div>‚Ä¶</div>
      </div>
    </div>

    <div id="phase">
      <h2>Preflop ü§≤</h2>
      <h2>Flop üëÄ</h2>
      <h2>Turn ‚Ü©Ô∏è</h2>
      <h2>River <i>üåä</i></h2>
    </div>

    <script>
      "use strict";

      setBoard();
      setHand();
      setRank();
      setStats();
      setPhase();
      hideMobileAddressBar();

      function setBoard() {
        const element = document.getElementById("board");
        const cards = element.querySelectorAll(".card");
        cards.forEach((card) => setCard(card));
      }

      function setHand() {
        const element = document.getElementById("hands");
        const cards = element.querySelectorAll(".card");
        cards.forEach((card) => setCard(card));
      }

      function setCard(
        element,
        rank = (setCard.options ??= ["A", "K", "Q", "J", ...Array.from({ length: 9 }, (_, i) => 10 - i)].flatMap(
          (rank) => ["‚ô†Ô∏è", "‚ô•Ô∏è", "‚ô£Ô∏è", "‚ô¶Ô∏è"].map((suit) => `${rank} ${suit}`)
        ))[Math.floor(setCard.options.length * Math.random())]
      ) {
        element.textContent = rank;
        const select = document.createElement("select");
        select.addEventListener("change", () => setCard(element, select.value));
        select.append(
          ...setCard.options.map((option) =>
            Object.assign(document.createElement("option"), {
              selected: option === element.textContent,
              textContent: option,
            })
          )
        );
        element.append(select);
      }

      function setRank() {
        const colors = ["navy", "white", "cyan", "orange", "magenta"].slice(0, 3);
        const element = document.getElementById("rank");
        const legendItems = element.querySelectorAll("button");
        const canvas = element.querySelector("canvas");
        const ctx = canvas.getContext("2d");

        new ResizeObserver(onResize).observe(canvas);
        canvas.addEventListener("pointerdown", (e) => {
          canvas.setPointerCapture(e.pointerId);
          document.documentElement.style.overflow = "clip";
          document.documentElement.style.scrollbarGutter = "stable";
          const done = () => {
            canvas.removeEventListener("pointerup", done);
            canvas.removeEventListener("pointercancel", done);
            canvas.releasePointerCapture(e.pointerId);
            document.documentElement.style.overflow = document.documentElement.style.scrollbarGutter = null;
          };
          canvas.addEventListener("pointerup", done);
          canvas.addEventListener("pointercancel", done);
          draw({ crosshair: (e.clientX - canvas.getBoundingClientRect().left) * globalThis.devicePixelRatio });
        });
        canvas.addEventListener("pointermove", (e) =>
          draw({ crosshair: (e.clientX - canvas.getBoundingClientRect().left) * globalThis.devicePixelRatio })
        );

        legendItems.forEach((item, i) => item.style.setProperty("--color", colors[i]));

        function draw({ crosshair = canvas.width * Math.random() } = {}) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = "#00240088";
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          // Placeholder content...
          colors.forEach((color, i) => {
            const mean = mix(0, canvas.width, Math.random());
            const stdDev = mix(0, canvas.width / 6, Math.random());

            [...Array(7462).keys()].forEach((j) => {
              const x = mix(0, canvas.width, j / (7462 - 1));
              const h = mix(0, canvas.height, Math.random() * Math.exp((-1 * (x - mean) ** 2) / 2 / stdDev ** 2));
              const w = canvas.width / 7462;
              ctx.fillStyle = color;
              ctx.fillRect(x, canvas.height - h, w, h);
            });
          });

          ctx.fillStyle = "lime";
          ctx.lineWidth = 1.5 * globalThis.devicePixelRatio;
          ctx.fillRect(crosshair - ctx.lineWidth, 0, ctx.lineWidth, canvas.height);
        }

        function onResize() {
          Object.assign(canvas, {
            height: Math.ceil(canvas.clientHeight * globalThis.devicePixelRatio),
            width: Math.ceil(canvas.clientWidth * globalThis.devicePixelRatio),
          });

          draw();
        }

        function mix(a, b, t) {
          return a + (b - a) * t;
        }
      }

      function setStats() {
        const element = document.getElementById("stats").children[1];
        // Placeholder content...
        element.innerHTML = element.innerHTML.repeat(10 ?? 100).replaceAll("‚Ä¶", () => Math.random().toFixed(4));
      }

      function setPhase() {
        const element = document.getElementById("phase");
        element.scrollLeft = parseFloat(getComputedStyle(element).paddingLeft);
        element.children[0].scrollIntoView({ behavior: "instant" });
        element.addEventListener("click", () => {
          if (current === 0) {
            [...document.querySelectorAll("#hands .card")].forEach((card) => setCard(card));
          } else {
            [...document.querySelectorAll("#board .card")]
              .slice(cardsShowing[current - 1], cardsShowing[current])
              .forEach((card) => setCard(card));
          }
        });
        let current = 0;
        const cardsShowing = [0, 3, 4, 5];
        element.addEventListener(
          "scroll",
          () => {
            const i = Math.round(element.scrollLeft / element.clientWidth);
            if (current !== i) {
              const previous = current;
              current = i;
              document.querySelectorAll("#board .card").forEach((card, j) => {
                const isMissing = j >= cardsShowing[current];
                const isNew = cardsShowing[previous] <= j && j < cardsShowing[current];
                card.classList.toggle("missing", isMissing);
                if (isNew) {
                  setCard(card);
                }
              });
              console.log("scrolled to", element.children[i].textContent);
            }
          },
          { passive: true }
        );
      }

      function hideMobileAddressBar() {
        window.scrollTo({
          top: 1,
          behavior: "instant",
        });
      }
    </script>
  </body>
</html>
